{% extends "base.html" %}
{% block title %}Sken inventury — AssetTrack{% endblock %}
{% block page_title %}Sken inventury{% endblock %}
{% block content %}

<div class="sh" style="margin-top:0">
  <a href="/inventury/{{ audit.id }}" class="btn btn-ghost">
    <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" width="13" height="13"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
    Zpět na inventuru
  </a>
</div>

{% if item %}
<div class="scan-result-card ok">
  <div style="font-size:10px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--green);margin-bottom:12px">Položka nalezena</div>
  <div style="font-size:18px;font-weight:600;color:var(--t1);margin-bottom:6px">{{ item.name }}</div>
  <div style="margin-bottom:16px"><span class="id-badge lg">{{ item.code }}</span></div>
  <div style="font-size:12px;color:var(--t3);margin-bottom:16px">Inventura: <strong style="color:var(--t2)">{{ audit.name }}</strong></div>
  <button class="btn btn-primary btn-full" onclick="doScan()" id="scanBtn">
    <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" width="13" height="13"><path d="M9 11l3 3L22 4"/></svg>
    Potvrdit sken
  </button>
</div>
{% else %}
<div class="scan-result-card err">
  <div style="font-size:10px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--red);margin-bottom:12px">Položka nenalezena</div>
  <div style="font-size:14px;color:var(--t2);margin-bottom:16px">Kód <span class="id-badge">{{ item_code }}</span> nebyl nalezen v databázi.</div>
  <a href="/sken" class="btn btn-ghost">Zpět na skenování</a>
</div>
{% endif %}

<div id="result" style="margin-top:12px"></div>

{% endblock %}

{% block scripts %}
<script>
async function doScan() {
  var btn = document.getElementById('scanBtn');
  if (btn) { btn.disabled = true; btn.textContent = 'Ukládám…'; }
  var res = await fetch('/api/audits/{{ audit.id }}/scan', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({item_id: {{ item.id if item else 0 }}})
  });
  var el = document.getElementById('result');
  if (res.ok) {
    el.innerHTML = '<div class="flash flash-success">Naskenováno úspěšně!</div>';
    setTimeout(function() { window.location = '/inventury/{{ audit.id }}'; }, 1500);
  } else {
    var err = await res.json();
    el.innerHTML = '<div class="flash flash-danger">' + (err.detail || 'Chyba') + '</div>';
    if (btn) { btn.disabled = false; btn.textContent = 'Potvrdit sken'; }
  }
}
</script>
{% endblock %}
